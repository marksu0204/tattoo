import{t as e}from"./heart-DjkT3NxO.js";import{_ as t,f as n,g as r,l as i,n as a,r as o,s,t as c,v as l}from"./index-C_gUkn22.js";var u=s(`funnel`,[[`path`,{d:`M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z`,key:`sc7q7i`}]]),d=l(t(),1),f=a(),p=(0,d.memo)(()=>(0,f.jsx)(`div`,{className:`aspect-[3/4] overflow-hidden rounded-lg bg-gray-800 animate-pulse`,children:(0,f.jsx)(`div`,{className:`w-full h-full bg-gradient-to-br from-gray-800 via-gray-700 to-gray-800`})})),m=(0,d.memo)(({src:e,alt:t,className:n})=>{let[r,i]=(0,d.useState)(!1),[a,o]=(0,d.useState)(!1);return(0,f.jsxs)(f.Fragment,{children:[!r&&!a&&(0,f.jsx)(`div`,{className:`absolute inset-0 bg-gray-800 animate-pulse`}),(0,f.jsx)(`img`,{src:e,alt:t,loading:`lazy`,decoding:`async`,onLoad:()=>i(!0),onError:()=>o(!0),className:`${n} ${r?`opacity-100`:`opacity-0`} transition-opacity duration-300`}),a&&(0,f.jsx)(`div`,{className:`absolute inset-0 bg-gray-800 flex items-center justify-center text-gray-500`,children:`載入失敗`})]})}),h=()=>{let{user:t,refreshUser:a}=c(),[s,l]=r(),h=s.get(`category`)||`All`,[g,_]=(0,d.useState)([]),[v,y]=(0,d.useState)([]),[b,x]=(0,d.useState)([]),[S,C]=(0,d.useState)(!0),[w,T]=(0,d.useState)(new Set);(0,d.useEffect)(()=>{E()},[]),(0,d.useEffect)(()=>{t?.favorites?T(new Set(t.favorites)):T(new Set)},[t?.favorites]),(0,d.useEffect)(()=>{if(h===`All`)y(g);else if(h===`Favorites`){let e=t?.favorites||[];y(g.filter(t=>e.includes(t.id)))}else y(g.filter(e=>e.category===h))},[h,g,t]);let E=async()=>{C(!0);let[e,t]=await Promise.all([o.getArtworks(),o.getCategories()]),n=e.filter(e=>e.status===i.AVAILABLE),r=e.filter(e=>e.status===i.CLAIMED),a=n.sort(()=>Math.random()-.5),s=r.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());_([...a,...s]),x(t),C(!1)},D=e=>{l({category:e})},O=async(e,n)=>{if(e.preventDefault(),e.stopPropagation(),!t){alert(`請先登入才能使用收藏功能！`);return}let r=w.has(n),i=new Set(w),s=new Set(w);r?s.delete(n):s.add(n),T(s);try{await o.toggleFavorite(t.id,n),await a()}catch(e){T(i),console.error(`Toggle favorite failed`,e),alert(`收藏功能發生錯誤，請稍後再試`)}},k=e=>w.has(e)?!0:t?.favorites?.includes(e)||!1;return(0,f.jsxs)(`div`,{className:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8`,children:[(0,f.jsx)(`div`,{className:`mb-10 text-center`,children:(0,f.jsx)(`p`,{className:`text-gray-400 max-w-xl mx-auto`,children:`白角刺青 | 台南刺青 | 右上角MENU有更多功能`})}),(0,f.jsxs)(`div`,{className:`flex overflow-x-auto no-scrollbar gap-3 mb-8 pb-2 items-center sm:justify-center`,children:[(0,f.jsx)(`div`,{className:`flex items-center text-gray-500 mr-2`,children:(0,f.jsx)(u,{size:16})}),b.map(e=>(0,f.jsx)(`button`,{onClick:()=>D(e),className:`whitespace-nowrap px-4 py-2 rounded-full text-sm font-medium transition-all ${h===e?`bg-primary text-black`:`bg-card text-gray-400 hover:bg-gray-800 hover:text-white`}`,children:e===`All`?`全部`:e},e)),t&&(0,f.jsxs)(`button`,{onClick:()=>D(`Favorites`),className:`whitespace-nowrap px-4 py-2 rounded-full text-sm font-medium transition-all flex items-center gap-2 ${h===`Favorites`?`bg-pink-600 text-white`:`bg-card text-gray-400 hover:bg-gray-800 hover:text-white`}`,children:[(0,f.jsx)(e,{size:14,className:`fill-current`}),` 我的收藏`]})]}),S?(0,f.jsx)(`div`,{className:`grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6`,children:[...Array(8)].map((e,t)=>(0,f.jsx)(p,{},t))}):(0,f.jsx)(`div`,{className:`grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6`,children:v.map(t=>(0,f.jsxs)(`div`,{className:`group relative aspect-[3/4] overflow-hidden rounded-lg bg-gray-900`,children:[(0,f.jsxs)(n,{to:`/artwork/${t.id}`,className:`absolute inset-0 z-0`,onClick:e=>{e.target.closest(`button`)&&e.preventDefault()},children:[(0,f.jsx)(m,{src:t.imageUrl,alt:t.title,className:`w-full h-full object-cover transition-transform duration-500 group-hover:scale-105 ${t.status===i.CLAIMED?`opacity-50 grayscale`:``}`}),(0,f.jsx)(`div`,{className:`absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300`}),(0,f.jsxs)(`div`,{className:`absolute bottom-0 left-0 p-4 w-full translate-y-4 group-hover:translate-y-0 transition-transform duration-300`,children:[(0,f.jsx)(`h3`,{className:`text-white font-bold truncate`,children:t.title}),(0,f.jsxs)(`div`,{className:`flex justify-between items-center`,children:[(0,f.jsx)(`p`,{className:`text-xs text-gray-300`,children:t.category}),t.specialPrice&&(0,f.jsx)(`span`,{className:`text-xs bg-red-600 text-white px-1.5 py-0.5 rounded font-bold`,children:`特價`})]})]}),(0,f.jsx)(`div`,{className:`absolute top-2 right-2 px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider ${t.status===i.CLAIMED?`bg-red-900/80 text-red-200`:`bg-green-900/80 text-green-200`}`,children:t.status===i.CLAIMED?`已認領`:`未認領`})]}),(0,f.jsx)(`button`,{onClick:e=>{e.preventDefault(),e.stopPropagation(),O(e,t.id)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},className:`absolute top-2 left-2 p-2 rounded-full transition-all hover:scale-110 z-50 pointer-events-auto ${k(t.id)?`text-pink-500 bg-white/10 border-2 border-pink-500/50`:`text-gray-800 border-2 border-gray-800 bg-white/80 hover:border-pink-500 hover:text-pink-500 hover:bg-white/90`}`,style:{pointerEvents:`auto`},children:(0,f.jsx)(e,{size:20,className:k(t.id)?`fill-current`:``})})]},t.id))}),!S&&v.length===0&&(0,f.jsx)(`div`,{className:`text-center py-20 text-gray-500`,children:`找不到相關設計。`})]})};export{h as default};