import{t as e}from"./download-DlM5fo4t.js";import{t}from"./layers-CBq1KnbF.js";import{t as n}from"./log-in-CqCf8gaW.js";import{t as r}from"./sparkles-BCdm-GlE.js";import{t as i}from"./trash-2-BzUrATsN.js";import{_ as a,f as o,g as s,i as c,m as ee,n as te,r as ne,s as l,t as re,v as u}from"./index-C_gUkn22.js";var ie=l(`chevron-down`,[[`path`,{d:`m6 9 6 6 6-6`,key:`qrunsl`}]]),ae=l(`chevrons-up-down`,[[`path`,{d:`m7 15 5 5 5-5`,key:`1hf1tw`}],[`path`,{d:`m7 9 5-5 5 5`,key:`sgt6xg`}]]),d=l(`flip-horizontal`,[[`path`,{d:`M8 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h3`,key:`1i73f7`}],[`path`,{d:`M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3`,key:`saxlbk`}],[`path`,{d:`M12 20v2`,key:`1lh1kg`}],[`path`,{d:`M12 14v2`,key:`8jcxud`}],[`path`,{d:`M12 8v2`,key:`1woqiv`}],[`path`,{d:`M12 2v2`,key:`tus03m`}]]),oe=l(`flip-vertical`,[[`path`,{d:`M21 8V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v3`,key:`14bfxa`}],[`path`,{d:`M21 16v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-3`,key:`14rx03`}],[`path`,{d:`M4 12H2`,key:`rhcxmi`}],[`path`,{d:`M10 12H8`,key:`s88cx1`}],[`path`,{d:`M16 12h-2`,key:`10asgb`}],[`path`,{d:`M22 12h-2`,key:`14jgyd`}]]),se=l(`hand`,[[`path`,{d:`M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2`,key:`1fvzgz`}],[`path`,{d:`M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2`,key:`1kc0my`}],[`path`,{d:`M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8`,key:`10h0bg`}],[`path`,{d:`M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15`,key:`1s1gnw`}]]),ce=l(`image`,[[`rect`,{width:`18`,height:`18`,x:`3`,y:`3`,rx:`2`,ry:`2`,key:`1m3agn`}],[`circle`,{cx:`9`,cy:`9`,r:`2`,key:`af1f0g`}],[`path`,{d:`m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21`,key:`1xmnt7`}]]),le=l(`maximize-2`,[[`path`,{d:`M15 3h6v6`,key:`1q9fwt`}],[`path`,{d:`m21 3-7 7`,key:`1l2asr`}],[`path`,{d:`m3 21 7-7`,key:`tjx5ai`}],[`path`,{d:`M9 21H3v-6`,key:`wtvkvv`}]]),ue=l(`move`,[[`path`,{d:`M12 2v20`,key:`t6zp3m`}],[`path`,{d:`m15 19-3 3-3-3`,key:`11eu04`}],[`path`,{d:`m19 9 3 3-3 3`,key:`1mg7y2`}],[`path`,{d:`M2 12h20`,key:`9i4pu4`}],[`path`,{d:`m5 9-3 3 3 3`,key:`j64kie`}],[`path`,{d:`m9 5 3-3 3 3`,key:`l8vdw6`}]]),de=l(`refresh-cw`,[[`path`,{d:`M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8`,key:`v9h5vc`}],[`path`,{d:`M21 3v5h-5`,key:`1q7to0`}],[`path`,{d:`M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16`,key:`3uifl3`}],[`path`,{d:`M8 16H3v5`,key:`1cv678`}]]),f=l(`rotate-cw`,[[`path`,{d:`M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8`,key:`1p45f6`}],[`path`,{d:`M21 3v5h-5`,key:`1q7to0`}]]),fe=l(`upload`,[[`path`,{d:`M12 3v12`,key:`1x0j5s`}],[`path`,{d:`m17 8-5-5-5 5`,key:`7q97r8`}],[`path`,{d:`M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4`,key:`ih7n3h`}]]),p=l(`zoom-in`,[[`circle`,{cx:`11`,cy:`11`,r:`8`,key:`4ej97u`}],[`line`,{x1:`21`,x2:`16.65`,y1:`21`,y2:`16.65`,key:`13gj7c`}],[`line`,{x1:`11`,x2:`11`,y1:`8`,y2:`14`,key:`1vmskp`}],[`line`,{x1:`8`,x2:`14`,y1:`11`,y2:`11`,key:`durymu`}]]),m=l(`zoom-out`,[[`circle`,{cx:`11`,cy:`11`,r:`8`,key:`4ej97u`}],[`line`,{x1:`21`,x2:`16.65`,y1:`21`,y2:`16.65`,key:`13gj7c`}],[`line`,{x1:`8`,x2:`14`,y1:`11`,y2:`11`,key:`durymu`}]]),h=u(a(),1),g=te(),_=()=>{let{user:a}=re(),[te]=s(),l=ee(),u=te.get(`artworkId`),[_,pe]=(0,h.useState)([]),[v,y]=(0,h.useState)(null),[b,me]=(0,h.useState)(!1),[he,ge]=(0,h.useState)(!0),[x,S]=(0,h.useState)(null),[C,w]=(0,h.useState)(null),[T,E]=(0,h.useState)({x:0,y:0,scale:1,rotation:0,flipX:!1,flipY:!1}),[D,O]=(0,h.useState)(.85),[k,A]=(0,h.useState)(1),[_e,j]=(0,h.useState)(!0),[ve,M]=(0,h.useState)(null),[N,ye]=(0,h.useState)(!1),P=(0,h.useRef)(null),F=(0,h.useRef)(null),[I,be]=(0,h.useState)({width:0,height:0}),[L,R]=(0,h.useState)(!1),[z,B]=(0,h.useState)({x:0,y:0}),[V,H]=(0,h.useState)(!1),[xe,U]=(0,h.useState)(0),[Se,W]=(0,h.useState)(0),G=(0,h.useRef)(null),Ce=(0,h.useRef)(null),[K,we]=(0,h.useState)({width:0,height:0}),q=(0,h.useRef)(null),J=(0,h.useRef)(null);if(!a)return(0,g.jsx)(`div`,{className:`min-h-screen bg-dark flex items-center justify-center px-4`,children:(0,g.jsx)(`div`,{className:`max-w-md w-full text-center`,children:(0,g.jsxs)(`div`,{className:`bg-card rounded-2xl border border-white/10 p-8 shadow-2xl`,children:[(0,g.jsx)(`div`,{className:`w-20 h-20 bg-primary/20 rounded-full flex items-center justify-center mx-auto mb-6`,children:(0,g.jsx)(r,{className:`w-10 h-10 text-primary`})}),(0,g.jsx)(`h1`,{className:`text-2xl font-bold text-white mb-3`,children:`åˆºé’é è¦½æ¨¡æ“¬`}),(0,g.jsxs)(`p`,{className:`text-gray-400 mb-6`,children:[`æ­¤åŠŸèƒ½éœ€è¦ç™»å…¥å¾Œæ‰èƒ½ä½¿ç”¨ã€‚`,(0,g.jsx)(`br`,{}),`è«‹å…ˆä½¿ç”¨ LINE å¸³è™Ÿç™»å…¥ï¼Œå³å¯é«”é©—åˆºé’é è¦½æ¨¡æ“¬åŠŸèƒ½ï¼`]}),(0,g.jsxs)(o,{to:`/login`,className:`inline-flex items-center gap-2 bg-[#06C755] hover:bg-[#05b34d] text-white font-bold py-4 px-8 rounded-xl transition-all hover:scale-105 shadow-lg`,children:[(0,g.jsx)(n,{size:20}),`LINE ç™»å…¥`]}),(0,g.jsx)(`p`,{className:`text-gray-500 text-sm mt-6`,children:`ç™»å…¥å¾Œå¯äº«å—å®Œæ•´çš„åˆºé’é è¦½é«”é©—`})]})})});let Y=(e,t)=>{let n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(n*n+r*r)},X=(e,t)=>{let n=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.atan2(r,n)*(180/Math.PI)};(0,h.useEffect)(()=>{(async()=>{ge(!0);try{let e=(await ne.getArtworks()).filter(e=>e.pngUrl);if(pe(e),u){let t=e.find(e=>e.id===u);t&&(y(t),Ee(t.pngUrl))}}catch(e){console.error(`Failed to load artworks:`,e)}finally{ge(!1)}})()},[u]);let[Te,Z]=(0,h.useState)(!1),Ee=e=>{let t=new window.Image;t.crossOrigin=`anonymous`,t.onload=()=>{J.current=t,w(e),Z(!0)},t.src=e};(0,h.useEffect)(()=>{Te&&K.width>0&&K.height>0&&(E({x:K.width/2,y:K.height/2,scale:.3,rotation:0,flipX:!1,flipY:!1}),Z(!1),j(!0))},[Te,K]);let De=e=>{y(e),e.pngUrl&&Ee(e.pngUrl),me(!1),l(`/preview?artworkId=${e.id}`,{replace:!0})},Oe=()=>{y(null),w(null),J.current=null,l(`/preview`,{replace:!0})},ke=e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=e=>{let t=new window.Image;t.onload=()=>{q.current=t,S(e.target?.result);let n=Ce.current;if(n){let e=window.innerWidth<768?.85:.95,r=n.clientWidth*e,i=t.height/t.width,a=Math.min(r,t.width);we({width:a,height:a*i}),J.current&&Z(!0)}},t.src=e.target?.result},e.readAsDataURL(t)}},Ae=e=>{let t=e.target.files?.[0];if(t){y(null),l(`/preview`,{replace:!0});let e=new FileReader;e.onload=e=>{let t=new window.Image;t.onload=()=>{J.current=t,w(e.target?.result),Z(!0)},t.src=e.target?.result},e.readAsDataURL(t)}},je=(0,h.useCallback)(()=>{let e=G.current,t=e?.getContext(`2d`);if(!(!e||!t)&&(t.fillStyle=`#1a1a1a`,t.fillRect(0,0,e.width,e.height),q.current&&(t.save(),t.translate(e.width/2,e.height/2),t.scale(k,k),t.drawImage(q.current,-e.width/2,-e.height/2,e.width,e.height),t.restore()),J.current&&C)){let e=J.current;t.save(),t.globalAlpha=D,t.translate(T.x,T.y),t.rotate(T.rotation*Math.PI/180),t.scale(T.flipX?-T.scale:T.scale,T.flipY?-T.scale:T.scale),t.drawImage(e,-e.width/2,-e.height/2,e.width,e.height),t.restore()}},[T,D,C,k]);(0,h.useEffect)(()=>{je()},[je,x,C,T,D,K,k]),(0,h.useEffect)(()=>{if(N&&F.current&&q.current){let e=F.current,t=q.current,n=e.clientWidth,r=e.clientHeight,i=t.height/t.width,a=r/n,o,s;i>a?(s=r*.95,o=s/i):(o=n*.95,s=o*i),be({width:o,height:s})}},[N]),(0,h.useEffect)(()=>{if(N){let e=window.scrollY;document.body.classList.add(`fullscreen-mode`),document.body.style.top=`-${e}px`,document.documentElement.style.overflow=`hidden`;let t=e=>{e.target.closest(`.fullscreen-canvas-area`)||e.preventDefault()};return document.addEventListener(`touchmove`,t,{passive:!1}),()=>{document.body.classList.remove(`fullscreen-mode`),document.body.style.top=``,document.documentElement.style.overflow=``,window.scrollTo(0,e),document.removeEventListener(`touchmove`,t)}}},[N]),(0,h.useEffect)(()=>{if(!N)return;let e=P.current,t=e?.getContext(`2d`);if(!e||!t)return;let n=K.width>0?e.width/K.width:1,r=K.height>0?e.height/K.height:1;if(t.fillStyle=`#1a1a1a`,t.fillRect(0,0,e.width,e.height),q.current&&(t.save(),t.translate(e.width/2,e.height/2),t.scale(k,k),t.drawImage(q.current,-e.width/2,-e.height/2,e.width,e.height),t.restore()),J.current&&C){let e=J.current;t.save(),t.globalAlpha=D;let i=T.x*n,a=T.y*r;t.translate(i,a),t.rotate(T.rotation*Math.PI/180),t.scale(T.flipX?-T.scale:T.scale,T.flipY?-T.scale:T.scale),t.drawImage(e,-e.width/2,-e.height/2,e.width,e.height),t.restore()}},[N,I,K,T,D,C,k]);let Me=e=>{if(!C)return;R(!0),j(!1);let t=G.current?.getBoundingClientRect();t&&B({x:e.clientX-t.left-T.x,y:e.clientY-t.top-T.y})},Ne=e=>{if(!L||!C)return;let t=G.current?.getBoundingClientRect();t&&E(n=>({...n,x:e.clientX-t.left-z.x,y:e.clientY-t.top-z.y}))},Pe=()=>{R(!1)},Fe=e=>{if(C){if(e.preventDefault(),j(!1),e.touches.length===1){R(!0),H(!1);let t=e.touches[0],n=G.current?.getBoundingClientRect();n&&B({x:t.clientX-n.left-T.x,y:t.clientY-n.top-T.y})}else if(e.touches.length===2){R(!1),H(!0);let t=Y(e.touches[0],e.touches[1]),n=X(e.touches[0],e.touches[1]);U(t),W(n)}}},Ie=e=>{if(C){if(e.preventDefault(),e.touches.length===1&&L&&!V){let t=e.touches[0],n=G.current?.getBoundingClientRect();n&&E(e=>({...e,x:t.clientX-n.left-z.x,y:t.clientY-n.top-z.y}))}else if(e.touches.length===2&&V){let t=Y(e.touches[0],e.touches[1]),n=X(e.touches[0],e.touches[1]),r=t/xe,i=n-Se;E(e=>({...e,scale:Math.max(.05,Math.min(3,e.scale*r)),rotation:e.rotation+i})),U(t),W(n)}}},Le=e=>{if(e.touches.length===0)R(!1),H(!1);else if(e.touches.length===1){H(!1),R(!0);let t=e.touches[0],n=G.current?.getBoundingClientRect();n&&B({x:t.clientX-n.left-T.x,y:t.clientY-n.top-T.y})}},Q=e=>{E(t=>({...t,scale:Math.max(.05,Math.min(3,t.scale+e))}))},$=e=>{E(t=>({...t,rotation:t.rotation+e}))},Re=()=>{E(e=>({...e,flipX:!e.flipX}))},ze=()=>{E(e=>({...e,flipY:!e.flipY}))};return(0,g.jsxs)(`div`,{className:`min-h-screen bg-gradient-to-br from-gray-900 via-gray-950 to-black py-8 px-4`,children:[(0,g.jsxs)(`div`,{className:`max-w-4xl mx-auto`,children:[(0,g.jsxs)(`div`,{className:`text-center mb-8`,children:[(0,g.jsxs)(`h1`,{className:`text-3xl md:text-4xl font-bold text-white mb-3 tracking-tight`,children:[(0,g.jsx)(`span`,{className:`text-primary`,children:`åˆºé’`}),`é è¦½æ¨¡æ“¬å™¨`]}),(0,g.jsx)(`p`,{className:`text-gray-400 max-w-lg mx-auto`,children:`ä¸Šå‚³æ‚¨çš„èº«é«”éƒ¨ä½ç…§ç‰‡ï¼Œæ­é…åˆºé’åœ–æ¡ˆé€²è¡Œé è¦½ï¼Œç¢ºèªæ•ˆæžœå¾Œå³å¯ä¸‹è¼‰åˆæˆç…§ç‰‡`})]}),_.length>0&&(0,g.jsxs)(`div`,{className:`mb-6`,children:[(0,g.jsxs)(`div`,{className:`flex items-center gap-2 mb-2`,children:[(0,g.jsx)(r,{size:16,className:`text-primary`}),(0,g.jsx)(`span`,{className:`text-sm font-medium text-gray-300`,children:`å¾žä½œå“é›†é¸æ“‡åˆºé’åœ–æ¡ˆ`})]}),(0,g.jsxs)(`div`,{className:`relative`,children:[(0,g.jsxs)(`button`,{onClick:()=>me(!b),className:`w-full bg-gray-800/80 border border-white/10 rounded-xl p-4 flex items-center justify-between hover:bg-gray-800 transition-colors`,children:[v?(0,g.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,g.jsx)(`img`,{src:v.imageUrl,alt:v.title,className:`w-10 h-10 rounded-lg object-cover`}),(0,g.jsxs)(`div`,{className:`text-left`,children:[(0,g.jsx)(`p`,{className:`text-white font-medium`,children:v.title}),(0,g.jsx)(`p`,{className:`text-xs text-gray-500`,children:v.category})]})]}):(0,g.jsx)(`span`,{className:`text-gray-400`,children:`é¸æ“‡ä¸€å€‹åˆºé’åœ–æ¡ˆ...`}),(0,g.jsx)(ie,{size:20,className:`text-gray-400 transition-transform ${b?`rotate-180`:``}`})]}),b&&(0,g.jsx)(`div`,{className:`absolute z-20 w-full mt-2 bg-gray-900 border border-white/10 rounded-xl shadow-2xl max-h-64 overflow-y-auto`,children:he?(0,g.jsx)(`div`,{className:`p-4 text-center text-gray-500`,children:`è¼‰å…¥ä¸­...`}):_.length===0?(0,g.jsx)(`div`,{className:`p-4 text-center text-gray-500`,children:`ç›®å‰æ²’æœ‰å¯ç”¨çš„åˆºé’åœ–æ¡ˆ`}):_.map(e=>(0,g.jsxs)(`button`,{onClick:()=>De(e),className:`w-full p-3 flex items-center gap-3 hover:bg-white/5 transition-colors border-b border-white/5 last:border-b-0 ${v?.id===e.id?`bg-primary/10`:``}`,children:[(0,g.jsx)(`img`,{src:e.imageUrl,alt:e.title,className:`w-12 h-12 rounded-lg object-cover`}),(0,g.jsxs)(`div`,{className:`text-left flex-1`,children:[(0,g.jsx)(`p`,{className:`text-white font-medium`,children:e.title}),(0,g.jsx)(`p`,{className:`text-xs text-gray-500`,children:e.category})]}),v?.id===e.id&&(0,g.jsx)(`span`,{className:`text-primary text-xs font-bold`,children:`å·²é¸æ“‡`})]},e.id))})]}),v&&(0,g.jsxs)(`button`,{onClick:Oe,className:`mt-2 text-xs text-gray-500 hover:text-gray-300 flex items-center gap-1`,children:[(0,g.jsx)(c,{size:12}),` æ¸…é™¤é¸æ“‡ï¼Œæ”¹ç”¨è‡ªå·±ä¸Šå‚³çš„åœ–æ¡ˆ`]})]}),(0,g.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4 mb-6`,children:[(0,g.jsxs)(`div`,{className:`relative`,children:[(0,g.jsx)(`input`,{type:`file`,accept:`image/*`,onChange:ke,className:`hidden`,id:`bg-upload`}),(0,g.jsxs)(`label`,{htmlFor:`bg-upload`,className:`flex flex-col items-center justify-center p-6 rounded-xl border-2 border-dashed cursor-pointer transition-all duration-300 ${x?`border-green-500/50 bg-green-900/10`:`border-gray-600 hover:border-primary hover:bg-primary/5`}`,children:[(0,g.jsx)(ce,{className:`w-10 h-10 mb-3 ${x?`text-green-400`:`text-gray-500`}`}),(0,g.jsx)(`span`,{className:`text-sm font-medium text-gray-300`,children:x?`âœ“ å·²ä¸Šå‚³èº«é«”éƒ¨ä½ç…§ç‰‡`:`ä¸Šå‚³èº«é«”éƒ¨ä½ç…§ç‰‡`}),(0,g.jsx)(`span`,{className:`text-xs text-gray-500 mt-1`,children:`é»žæ“Šé¸æ“‡åœ–ç‰‡`})]})]}),(0,g.jsx)(`div`,{className:`relative`,children:v?(0,g.jsxs)(`div`,{className:`flex flex-col items-center justify-center p-6 rounded-xl border-2 border-purple-500/50 bg-purple-900/10`,children:[(0,g.jsx)(`img`,{src:v.pngUrl,alt:v.title,className:`w-16 h-16 object-contain mb-2`}),(0,g.jsxs)(`span`,{className:`text-sm font-medium text-purple-300`,children:[`âœ“ ä½¿ç”¨ä½œå“ï¼š`,v.title]}),(0,g.jsx)(`span`,{className:`text-xs text-gray-500 mt-1`,children:`å·²è‡ªå‹•è¼‰å…¥åˆºé’åœ–æ¡ˆ`})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(`input`,{type:`file`,accept:`image/png`,onChange:Ae,className:`hidden`,id:`tattoo-upload`}),(0,g.jsxs)(`label`,{htmlFor:`tattoo-upload`,className:`flex flex-col items-center justify-center p-6 rounded-xl border-2 border-dashed cursor-pointer transition-all duration-300 ${C?`border-green-500/50 bg-green-900/10`:`border-gray-600 hover:border-primary hover:bg-primary/5`}`,children:[(0,g.jsx)(t,{className:`w-10 h-10 mb-3 ${C?`text-green-400`:`text-gray-500`}`}),(0,g.jsx)(`span`,{className:`text-sm font-medium text-gray-300`,children:C?`âœ“ å·²ä¸Šå‚³åˆºé’åœ–æ¡ˆ`:`ä¸Šå‚³åˆºé’åœ–æ¡ˆ (PNG)`}),(0,g.jsx)(`span`,{className:`text-xs text-gray-500 mt-1`,children:`å»ºè­°ä½¿ç”¨åŽ»èƒŒPNGæª”`})]})]})})]}),(0,g.jsxs)(`div`,{className:`relative mb-6`,children:[(0,g.jsx)(`div`,{className:`absolute left-0 top-1/2 -translate-y-1/2 z-10 md:hidden`,children:(0,g.jsxs)(`div`,{className:`bg-gray-800/80 backdrop-blur-sm rounded-r-lg py-4 px-1 flex flex-col items-center gap-1 border-r border-y border-white/10`,children:[(0,g.jsx)(ae,{size:16,className:`text-gray-400`}),(0,g.jsx)(`span`,{className:`text-[10px] text-gray-500 writing-mode-vertical`,style:{writingMode:`vertical-rl`},children:`æ»‘å‹•`})]})}),(0,g.jsx)(`div`,{className:`absolute right-0 top-1/2 -translate-y-1/2 z-10 md:hidden`,children:(0,g.jsxs)(`div`,{className:`bg-gray-800/80 backdrop-blur-sm rounded-l-lg py-4 px-1 flex flex-col items-center gap-1 border-l border-y border-white/10`,children:[(0,g.jsx)(ae,{size:16,className:`text-gray-400`}),(0,g.jsx)(`span`,{className:`text-[10px] text-gray-500`,style:{writingMode:`vertical-rl`},children:`æ»‘å‹•`})]})}),(0,g.jsxs)(`div`,{ref:Ce,className:`relative bg-gray-900/50 rounded-2xl border border-white/10 overflow-hidden mx-6 md:mx-0`,style:{minHeight:`300px`},children:[(0,g.jsx)(`div`,{className:`h-4 md:h-2 bg-transparent`}),x?(0,g.jsxs)(`div`,{className:`px-3 md:px-2 relative`,children:[(0,g.jsx)(`canvas`,{ref:G,width:K.width,height:K.height,onMouseDown:Me,onMouseMove:Ne,onMouseUp:Pe,onMouseLeave:Pe,onTouchStart:Fe,onTouchMove:Ie,onTouchEnd:Le,className:`mx-auto block ${C?`cursor-move`:`cursor-default`}`,style:{maxWidth:`100%`,touchAction:`none`}}),C&&_e&&(0,g.jsx)(`div`,{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none md:hidden transition-opacity duration-500`,children:(0,g.jsxs)(`div`,{className:`bg-black/70 backdrop-blur-sm rounded-2xl p-4 flex flex-col items-center gap-2 border border-primary/30 shadow-lg shadow-primary/10 animate-pulse`,children:[(0,g.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,g.jsx)(se,{size:24,className:`text-primary`}),(0,g.jsx)(p,{size:20,className:`text-primary`})]}),(0,g.jsx)(`p`,{className:`text-xs text-white font-medium`,children:`é›™æŒ‡ç¸®æ”¾æ—‹è½‰`}),(0,g.jsx)(`p`,{className:`text-[10px] text-gray-400`,children:`å–®æŒ‡æ‹–æ›³ç§»å‹•`})]})}),C&&(0,g.jsx)(`button`,{onClick:()=>ye(!0),className:`absolute top-3 right-3 md:hidden bg-black/70 hover:bg-black/90 backdrop-blur-sm p-3 rounded-xl border border-white/20 transition-all active:scale-95`,children:(0,g.jsx)(le,{size:20,className:`text-white`})})]}):(0,g.jsxs)(`div`,{className:`flex flex-col items-center justify-center h-80 text-gray-500`,children:[(0,g.jsx)(fe,{className:`w-16 h-16 mb-4 opacity-30`}),(0,g.jsx)(`p`,{className:`text-lg`,children:`è«‹å…ˆä¸Šå‚³èº«é«”éƒ¨ä½ç…§ç‰‡`})]}),(0,g.jsx)(`div`,{className:`h-4 md:h-2 bg-transparent`}),x&&C&&(0,g.jsx)(`div`,{className:`absolute bottom-5 left-1/2 transform -translate-x-1/2 bg-black/70 backdrop-blur-sm px-4 py-2 rounded-full`,children:(0,g.jsxs)(`p`,{className:`text-xs text-gray-300 flex items-center gap-2`,children:[(0,g.jsx)(ue,{size:14}),(0,g.jsx)(`span`,{className:`hidden sm:inline`,children:`æ‹–æ›³ç§»å‹• Â· é›™æŒ‡ç¸®æ”¾æ—‹è½‰`}),(0,g.jsx)(`span`,{className:`sm:hidden`,children:`æ‹–æ›³ç§»å‹• Â· é›™æŒ‡ç¸®æ”¾`})]})})]})]}),x&&C&&(0,g.jsx)(`div`,{className:`bg-gray-900/50 rounded-xl border border-white/10 p-5 mb-6`,children:(0,g.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,g.jsxs)(`div`,{children:[(0,g.jsxs)(`label`,{className:`block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2`,children:[(0,g.jsx)(p,{size:16}),` ç¸®æ”¾å¤§å°`]}),(0,g.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,g.jsx)(`button`,{onClick:()=>Q(-.05),className:`p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white transition-colors`,children:(0,g.jsx)(m,{size:18})}),(0,g.jsx)(`input`,{type:`range`,min:`0.05`,max:`3`,step:`0.01`,value:T.scale,onChange:e=>E(t=>({...t,scale:parseFloat(e.target.value)})),className:`flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-primary`}),(0,g.jsx)(`button`,{onClick:()=>Q(.05),className:`p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white transition-colors`,children:(0,g.jsx)(p,{size:18})}),(0,g.jsxs)(`span`,{className:`text-sm text-gray-400 w-14 text-right`,children:[(T.scale*100).toFixed(0),`%`]})]})]}),(0,g.jsxs)(`div`,{children:[(0,g.jsxs)(`label`,{className:`block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2`,children:[(0,g.jsx)(f,{size:16}),` æ—‹è½‰è§’åº¦`]}),(0,g.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,g.jsx)(`button`,{onClick:()=>$(-15),className:`p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white transition-colors`,children:(0,g.jsx)(f,{size:18,className:`transform -scale-x-100`})}),(0,g.jsx)(`input`,{type:`range`,min:`-180`,max:`180`,step:`1`,value:T.rotation,onChange:e=>E(t=>({...t,rotation:parseFloat(e.target.value)})),className:`flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-primary`}),(0,g.jsx)(`button`,{onClick:()=>$(15),className:`p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white transition-colors`,children:(0,g.jsx)(f,{size:18})}),(0,g.jsxs)(`span`,{className:`text-sm text-gray-400 w-14 text-right`,children:[T.rotation.toFixed(0),`Â°`]})]})]}),(0,g.jsxs)(`div`,{children:[(0,g.jsxs)(`label`,{className:`block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2`,children:[(0,g.jsx)(d,{size:16}),` ç¿»è½‰`]}),(0,g.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,g.jsxs)(`button`,{onClick:Re,className:`flex-1 p-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${T.flipX?`bg-primary text-black`:`bg-gray-800 hover:bg-gray-700 text-white`}`,children:[(0,g.jsx)(d,{size:18}),(0,g.jsx)(`span`,{className:`text-sm`,children:`æ°´å¹³ç¿»è½‰`})]}),(0,g.jsxs)(`button`,{onClick:ze,className:`flex-1 p-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${T.flipY?`bg-primary text-black`:`bg-gray-800 hover:bg-gray-700 text-white`}`,children:[(0,g.jsx)(oe,{size:18}),(0,g.jsx)(`span`,{className:`text-sm`,children:`åž‚ç›´ç¿»è½‰`})]})]})]}),(0,g.jsxs)(`div`,{children:[(0,g.jsxs)(`label`,{className:`block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2`,children:[(0,g.jsx)(t,{size:16}),` åˆºé’é€æ˜Žåº¦`]}),(0,g.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,g.jsx)(`input`,{type:`range`,min:`0.1`,max:`1`,step:`0.01`,value:D,onChange:e=>O(parseFloat(e.target.value)),className:`flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-primary`}),(0,g.jsxs)(`span`,{className:`text-sm text-gray-400 w-14 text-right`,children:[(D*100).toFixed(0),`%`]})]})]}),(0,g.jsxs)(`div`,{children:[(0,g.jsxs)(`label`,{className:`block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2`,children:[(0,g.jsx)(ce,{size:16}),` èƒŒæ™¯ç¸®æ”¾`]}),(0,g.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,g.jsx)(`button`,{onClick:()=>A(e=>Math.max(.5,e-.1)),className:`p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white transition-colors`,children:(0,g.jsx)(m,{size:18})}),(0,g.jsx)(`input`,{type:`range`,min:`0.5`,max:`2`,step:`0.05`,value:k,onChange:e=>A(parseFloat(e.target.value)),className:`flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500`}),(0,g.jsx)(`button`,{onClick:()=>A(e=>Math.min(2,e+.1)),className:`p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-white transition-colors`,children:(0,g.jsx)(p,{size:18})}),(0,g.jsxs)(`span`,{className:`text-sm text-gray-400 w-14 text-right`,children:[(k*100).toFixed(0),`%`]})]})]})]})}),(0,g.jsxs)(`div`,{className:`flex flex-wrap gap-3 justify-center`,children:[x&&C&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(`button`,{onClick:()=>{E({x:K.width/2,y:K.height/2,scale:.3,rotation:0,flipX:!1,flipY:!1}),O(.85),A(1)},className:`flex items-center gap-2 px-5 py-3 rounded-xl bg-gray-800 hover:bg-gray-700 text-white font-medium transition-all`,children:[(0,g.jsx)(de,{size:18}),` é‡ç½®ä½ç½®`]}),(0,g.jsxs)(`button`,{onClick:()=>{if(!G.current||!x)return;let e=document.createElement(`canvas`),t=e.getContext(`2d`);if(!t||!q.current)return;let n=q.current;e.width=n.width,e.height=n.height,t.save(),t.translate(e.width/2,e.height/2),t.scale(k,k),t.drawImage(n,-n.width/2,-n.height/2),t.restore();let r=n.width/K.width;if(J.current&&C){let e=J.current;t.save(),t.globalAlpha=D,t.translate(T.x*r,T.y*r),t.rotate(T.rotation*Math.PI/180),t.scale((T.flipX?-1:1)*T.scale*r,(T.flipY?-1:1)*T.scale*r),t.drawImage(e,-e.width/2,-e.height/2,e.width,e.height),t.restore()}let i=e.toDataURL(`image/png`),a=v?.title||`custom`;if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))M(i);else{let e=document.createElement(`a`);e.download=`tattoo-preview-${a}-${Date.now()}.png`,e.href=i,document.body.appendChild(e),e.click(),document.body.removeChild(e)}},className:`flex items-center gap-2 px-6 py-3 rounded-xl bg-primary hover:bg-primary/90 text-black font-bold transition-all shadow-lg shadow-primary/25`,children:[(0,g.jsx)(e,{size:18}),` ä¸‹è¼‰åˆæˆç…§ç‰‡`]})]}),(x||C)&&(0,g.jsxs)(`button`,{onClick:()=>{S(null),w(null),y(null),q.current=null,J.current=null,we({width:0,height:0}),E({x:0,y:0,scale:1,rotation:0,flipX:!1,flipY:!1}),A(1),O(.85),j(!0),l(`/preview`,{replace:!0})},className:`flex items-center gap-2 px-5 py-3 rounded-xl bg-red-900/50 hover:bg-red-800/60 text-red-200 font-medium transition-all`,children:[(0,g.jsx)(i,{size:18}),` æ¸…é™¤å…¨éƒ¨`]})]}),(0,g.jsxs)(`div`,{className:`mt-10 bg-gray-900/30 rounded-xl border border-white/5 p-6`,children:[(0,g.jsx)(`h3`,{className:`text-lg font-bold text-white mb-4`,children:`ðŸ“– ä½¿ç”¨èªªæ˜Ž`}),(0,g.jsxs)(`ol`,{className:`space-y-3 text-gray-400 text-sm`,children:[(0,g.jsxs)(`li`,{className:`flex items-start gap-3`,children:[(0,g.jsx)(`span`,{className:`flex-shrink-0 w-6 h-6 rounded-full bg-primary/20 text-primary text-xs font-bold flex items-center justify-center`,children:`1`}),(0,g.jsx)(`span`,{children:`ä¸Šå‚³æ‚¨æƒ³è¦åˆºé’çš„èº«é«”éƒ¨ä½ç…§ç‰‡ï¼ˆå¦‚æ‰‹è‡‚ã€å°è…¿ç­‰ï¼‰`})]}),(0,g.jsxs)(`li`,{className:`flex items-start gap-3`,children:[(0,g.jsx)(`span`,{className:`flex-shrink-0 w-6 h-6 rounded-full bg-primary/20 text-primary text-xs font-bold flex items-center justify-center`,children:`2`}),(0,g.jsx)(`span`,{children:`å¾žä½œå“é›†é¸æ“‡åˆºé’åœ–æ¡ˆï¼Œæˆ–ä¸Šå‚³è‡ªå·±çš„åŽ»èƒŒ PNG æª”æ¡ˆ`})]}),(0,g.jsxs)(`li`,{className:`flex items-start gap-3`,children:[(0,g.jsx)(`span`,{className:`flex-shrink-0 w-6 h-6 rounded-full bg-primary/20 text-primary text-xs font-bold flex items-center justify-center`,children:`3`}),(0,g.jsx)(`span`,{children:`å–®æŒ‡æ‹–æ›³ç§»å‹•åˆºé’ Â· é›™æŒ‡æåˆç¸®æ”¾ Â· é›™æŒ‡æ—‹è½‰èª¿æ•´è§’åº¦`})]}),(0,g.jsxs)(`li`,{className:`flex items-start gap-3`,children:[(0,g.jsx)(`span`,{className:`flex-shrink-0 w-6 h-6 rounded-full bg-primary/20 text-primary text-xs font-bold flex items-center justify-center`,children:`4`}),(0,g.jsx)(`span`,{children:`ä½¿ç”¨æŽ§åˆ¶é …èª¿æ•´å¤§å°ã€æ—‹è½‰ã€ç¿»è½‰å’Œé€æ˜Žåº¦`})]}),(0,g.jsxs)(`li`,{className:`flex items-start gap-3`,children:[(0,g.jsx)(`span`,{className:`flex-shrink-0 w-6 h-6 rounded-full bg-primary/20 text-primary text-xs font-bold flex items-center justify-center`,children:`5`}),(0,g.jsx)(`span`,{children:`ç¢ºèªæ•ˆæžœæ»¿æ„å¾Œï¼Œé»žæ“Šã€Œä¸‹è¼‰åˆæˆç…§ç‰‡ã€ä¿å­˜çµæžœ`})]})]})]})]}),N&&x&&C&&(0,g.jsxs)(`div`,{className:`fixed inset-0 bg-black z-50 flex flex-col fullscreen-overlay`,style:{touchAction:`none`,overscrollBehavior:`none`},children:[(0,g.jsxs)(`div`,{className:`flex-shrink-0 bg-gray-900/95 backdrop-blur-sm border-b border-white/10 px-4 py-3 flex items-center justify-between safe-area-top`,children:[(0,g.jsx)(`h3`,{className:`text-white font-bold text-lg`,children:`å…¨èž¢å¹•ç·¨è¼¯`}),(0,g.jsx)(`button`,{onClick:()=>ye(!1),className:`bg-gray-800 hover:bg-gray-700 p-2 rounded-xl border border-white/10 transition-colors`,children:(0,g.jsx)(c,{size:24,className:`text-white`})})]}),(0,g.jsx)(`div`,{ref:F,className:`flex-1 flex items-center justify-center p-2 overflow-hidden fullscreen-canvas-area`,style:{touchAction:`none`},children:(0,g.jsx)(`canvas`,{ref:P,width:I.width,height:I.height,onMouseDown:e=>{if(!C)return;R(!0),j(!1);let t=K.width>0?I.width/K.width:1,n=K.height>0?I.height/K.height:1,r=P.current?.getBoundingClientRect();r&&B({x:e.clientX-r.left-T.x*t,y:e.clientY-r.top-T.y*n})},onMouseMove:e=>{if(!L||!C)return;let t=I.width>0?K.width/I.width:1,n=I.height>0?K.height/I.height:1,r=P.current?.getBoundingClientRect();if(r){let i=e.clientX-r.left-z.x,a=e.clientY-r.top-z.y;E(e=>({...e,x:i*t,y:a*n}))}},onMouseUp:()=>R(!1),onMouseLeave:()=>R(!1),onTouchStart:e=>{if(!C)return;e.preventDefault(),j(!1);let t=K.width>0?I.width/K.width:1,n=K.height>0?I.height/K.height:1;if(e.touches.length===1){R(!0),H(!1);let r=e.touches[0],i=P.current?.getBoundingClientRect();i&&B({x:r.clientX-i.left-T.x*t,y:r.clientY-i.top-T.y*n})}else if(e.touches.length===2){R(!1),H(!0);let t=Y(e.touches[0],e.touches[1]),n=X(e.touches[0],e.touches[1]);U(t),W(n)}},onTouchMove:e=>{if(!C)return;e.preventDefault();let t=I.width>0?K.width/I.width:1,n=I.height>0?K.height/I.height:1;if(e.touches.length===1&&L&&!V){let r=e.touches[0],i=P.current?.getBoundingClientRect();if(i){let e=r.clientX-i.left-z.x,a=r.clientY-i.top-z.y;E(r=>({...r,x:e*t,y:a*n}))}}else if(e.touches.length===2&&V){let t=Y(e.touches[0],e.touches[1]),n=X(e.touches[0],e.touches[1]),r=t/xe,i=n-Se;E(e=>({...e,scale:Math.max(.05,Math.min(3,e.scale*r)),rotation:e.rotation+i})),U(t),W(n)}},onTouchEnd:e=>{let t=K.width>0?I.width/K.width:1,n=K.height>0?I.height/K.height:1;if(e.touches.length===0)R(!1),H(!1);else if(e.touches.length===1){H(!1),R(!0);let r=e.touches[0],i=P.current?.getBoundingClientRect();i&&B({x:r.clientX-i.left-T.x*t,y:r.clientY-i.top-T.y*n})}},className:`cursor-move max-w-full max-h-full`,style:{touchAction:`none`}})}),(0,g.jsxs)(`div`,{className:`flex-shrink-0 bg-gray-900/95 backdrop-blur-sm border-t border-white/10 px-4 py-3 safe-area-bottom`,children:[(0,g.jsxs)(`div`,{className:`flex items-center justify-center gap-3 mb-3`,children:[(0,g.jsx)(`button`,{onClick:()=>Q(-.1),className:`p-3 rounded-xl bg-gray-800 hover:bg-gray-700 text-white transition-colors border border-white/10`,children:(0,g.jsx)(m,{size:22})}),(0,g.jsx)(`button`,{onClick:()=>Q(.1),className:`p-3 rounded-xl bg-gray-800 hover:bg-gray-700 text-white transition-colors border border-white/10`,children:(0,g.jsx)(p,{size:22})}),(0,g.jsx)(`button`,{onClick:()=>$(-15),className:`p-3 rounded-xl bg-gray-800 hover:bg-gray-700 text-white transition-colors border border-white/10`,children:(0,g.jsx)(f,{size:22,className:`transform -scale-x-100`})}),(0,g.jsx)(`button`,{onClick:()=>$(15),className:`p-3 rounded-xl bg-gray-800 hover:bg-gray-700 text-white transition-colors border border-white/10`,children:(0,g.jsx)(f,{size:22})}),(0,g.jsx)(`button`,{onClick:Re,className:`p-3 rounded-xl transition-colors border border-white/10 ${T.flipX?`bg-primary text-black`:`bg-gray-800 hover:bg-gray-700 text-white`}`,children:(0,g.jsx)(d,{size:22})}),(0,g.jsx)(`button`,{onClick:ze,className:`p-3 rounded-xl transition-colors border border-white/10 ${T.flipY?`bg-primary text-black`:`bg-gray-800 hover:bg-gray-700 text-white`}`,children:(0,g.jsx)(oe,{size:22})})]}),(0,g.jsxs)(`div`,{className:`flex items-center gap-3 px-2`,children:[(0,g.jsx)(t,{size:16,className:`text-gray-400 flex-shrink-0`}),(0,g.jsx)(`input`,{type:`range`,min:`0.1`,max:`1`,step:`0.01`,value:D,onChange:e=>O(parseFloat(e.target.value)),className:`flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-primary`}),(0,g.jsxs)(`span`,{className:`text-xs text-gray-400 w-10 text-right`,children:[(D*100).toFixed(0),`%`]})]})]})]}),ve&&(0,g.jsx)(`div`,{className:`fixed inset-0 bg-black/90 z-50 flex flex-col items-center justify-center p-4`,children:(0,g.jsxs)(`div`,{className:`bg-gray-900 rounded-2xl border border-white/10 p-4 max-w-lg w-full max-h-[90vh] overflow-auto`,children:[(0,g.jsxs)(`div`,{className:`flex justify-between items-center mb-4`,children:[(0,g.jsx)(`h3`,{className:`text-lg font-bold text-white`,children:`ä¿å­˜åœ–ç‰‡`}),(0,g.jsx)(`button`,{onClick:()=>M(null),className:`text-gray-400 hover:text-white p-1`,children:(0,g.jsx)(c,{size:24})})]}),(0,g.jsx)(`div`,{className:`bg-gray-800 rounded-xl p-2 mb-4`,children:(0,g.jsx)(`img`,{src:ve,alt:`åˆæˆé è¦½`,className:`w-full h-auto rounded-lg`})}),(0,g.jsxs)(`div`,{className:`bg-primary/10 border border-primary/30 rounded-xl p-4 mb-4`,children:[(0,g.jsx)(`p`,{className:`text-primary font-medium text-center mb-2`,children:`ðŸ“± ä¿å­˜æ–¹å¼`}),(0,g.jsxs)(`p`,{className:`text-gray-300 text-sm text-center`,children:[(0,g.jsx)(`strong`,{children:`é•·æŒ‰ä¸Šæ–¹åœ–ç‰‡`}),`ï¼Œç„¶å¾Œé¸æ“‡ã€Œä¿å­˜åœ–ç‰‡ã€æˆ–ã€ŒåŠ å…¥ç…§ç‰‡ã€`]})]}),(0,g.jsx)(`button`,{onClick:()=>M(null),className:`w-full py-3 rounded-xl bg-primary hover:bg-primary/90 text-black font-bold transition-colors`,children:`é—œé–‰`})]})})]})};export{_ as default};